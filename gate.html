<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>เข้าสู่ระบบบันทึกการใช้งาน</title>
<style>
body { font-family: sans-serif; text-align: center; margin-top: 50px; }
input, button { padding: 10px; margin: 5px; width: 250px; }
button { background: #28a745; color: white; border: none; border-radius: 5px; }
button:hover { background: #218838; cursor: pointer; }
</style>
</head>
<body>
<h1>เข้าสู่ระบบค้นหารหัสปัญหา</h1>
<p>กรอกข้อมูลเพื่อยืนยันว่าคุณได้ทำการบันทึกการใช้งานแล้ว</p>

<input type="text" id="dlr" placeholder="DLR Code/บริษัท">
<input type="text" id="name" placeholder="ชื่อ">
<input type="text" id="dept" placeholder="แผนก/ฝ่าย">
<br>
<button onclick="checkAccess()">เข้าสู่ระบบ</button>

<script>
const SHEET_ID = "1qYvaLiCw5fb1hkfYdOIDLdwez7s_TVBiGLcv_btt10o";
const API_KEY = "AIzaSyAIOa8r5Hl39CANQFUrw7KpftRoYO1VvCs";
const RANGE = "A:D"; // Timestamp, DLR Code/บริษัท, แผนก/ฝ่าย, ชื่อ

async function checkAccess() {
    const dlr = document.getElementById("dlr").value.trim();
    const name = document.getElementById("name").value.trim();
    const dept = document.getElementById("dept").value.trim();

    if (!dlr || !name || !dept) {
        alert("กรุณากรอกข้อมูลให้ครบ");
        return;
    }

    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
    try {
        const res = await fetch(url);
        const data = await res.json();
        const rows = data.values || [];

        const found = rows.slice(1).some(row => 
            row[1]?.trim() === dlr && row[2]?.trim() === dept && row[3]?.trim() === name
        );

        if (found) {
            window.location.href = "index.html";
        } else {
            alert("ไม่พบข้อมูล กรุณากรอก Google Forms ก่อนเข้าใช้งาน");
        }
    } catch (err) {
        console.error(err);
        alert("เกิดข้อผิดพลาดในการเชื่อมต่อข้อมูล");
    }
}
</script>
</body>
</html>